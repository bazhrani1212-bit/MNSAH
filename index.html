<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>منصة قياس الأثر ورضا المستفيد</title>
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI",Tahoma,Arial; margin:0; background:#f6f7fb;}
    header{background:#0f766e;color:#fff;padding:14px 12px;}
    .wrap{max-width:980px;margin:0 auto;padding:14px;}
    .card{background:#fff;border-radius:14px;padding:14px;box-shadow:0 1px 8px rgba(0,0,0,.06);margin:10px 0;}
    .tabs{display:flex;gap:8px;flex-wrap:wrap;margin:12px 0;}
    .tab{border:0;padding:10px 12px;border-radius:10px;background:#fff;cursor:pointer;box-shadow:0 1px 4px rgba(0,0,0,.06)}
    .tab.active{background:#e6fffb;outline:2px solid #14b8a6}
    label{display:block;margin:10px 0 6px;font-weight:800}
    input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #d0d7de;font-size:14px}
    textarea{min-height:90px}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
    @media(max-width:720px){.row{grid-template-columns:1fr}}
    .btn{border:0;background:#0f766e;color:#fff;padding:12px 14px;border-radius:12px;cursor:pointer;font-weight:900}
    .btn.secondary{background:#334155}
    .ok{display:none;background:#ecfdf5;border:1px solid #10b981;color:#065f46;padding:10px;border-radius:12px;margin:10px 0}
    .err{display:none;background:#fef2f2;border:1px solid #ef4444;color:#7f1d1d;padding:10px;border-radius:12px;margin:10px 0}
    footer{padding:18px 12px;color:#64748b;font-size:12px;text-align:center}
    .req{color:#dc2626;font-weight:900}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div style="font-weight:1000;font-size:18px;">منصة قياس الأثر ورضا المستفيد</div>
    <div style="opacity:.95;font-size:13px;line-height:1.5;">
      المدرسة: <b>الابتدائية السادسة والثلاثون بالخميس</b> — مديرة المدرسة: <b>نورة الرفاعي</b>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="card">
    <a class="btn secondary" href="./admin.html">لوحة المديرة</a>
  </div>

  <div class="tabs">
    <button class="tab active" data-view="impact">قياس أثر برنامج</button>
    <button class="tab" data-view="teachers">رضا المعلم</button>
    <button class="tab" data-view="students">رضا الطالب عن المدرسة</button>
    <button class="tab" data-view="parents">رضا ولي الأمر</button>
    <button class="tab" data-view="studentTeacher">رضا الطالب عن المعلم</button>
  </div>

  <div class="ok" id="okBox">تم حفظ الاستجابة ✅</div>
  <div class="err" id="errBox"></div>

  <!-- iframe + form (تجاوز CORS) -->
  <iframe name="hiddenFrame" style="display:none;"></iframe>
  <form id="submitForm" target="hiddenFrame" method="POST">
    <input type="hidden" name="action" value="submit">
    <input type="hidden" name="payload" id="payloadInput" value="">
  </form>

  <!-- ===== نموذج قياس الأثر (مختصر وعملي) ===== -->
  <section id="impact" class="card">
    <h3 style="margin:0 0 10px;">قياس أثر برنامج</h3>
    <div class="row">
      <div>
        <label>اسم المدرسة <span class="req">*</span></label>
        <input id="impact_school" value="الابتدائية السادسة والثلاثون بالخميس">
      </div>
      <div>
        <label>اسم البرنامج <span class="req">*</span></label>
        <input id="impact_program" placeholder="مثال: برنامج إرشادي">
      </div>
    </div>
    <div class="row">
      <div>
        <label>نسبة تحقق الأهداف (0-100)</label>
        <input id="impact_goalPct" type="number" min="0" max="100">
      </div>
      <div>
        <label>النسبة المئوية للأثر (0-100)</label>
        <input id="impact_effectPct" type="number" min="0" max="100">
      </div>
    </div>
    <label>ملاحظات/إيجابيات</label>
    <textarea id="impact_positives"></textarea>
    <label>صعوبات</label>
    <textarea id="impact_challenges"></textarea>
    <button class="btn" type="button" id="impact_submit">إرسال وحفظ</button>
  </section>

  <!-- نماذج الاستبانات (نضعها مختصرة هنا، ولو تبين أرجعها كاملة مثل السابق أرسلها لك) -->
  <section id="teachers" class="card" style="display:none">
    <h3 style="margin:0 0 10px;">رضا المعلم</h3>
    <label>اسم المدرسة <span class="req">*</span></label>
    <input id="t_school" value="الابتدائية السادسة والثلاثون بالخميس">
    <label>مثال إجابة بند 1</label>
    <select id="t_q1">
      <option value="">اختر</option><option>دائماً</option><option>غالباً</option><option>أحياناً</option><option>نادراً</option>
    </select>
    <button class="btn" type="button" id="t_submit">إرسال وحفظ</button>
  </section>

  <section id="students" class="card" style="display:none">
    <h3 style="margin:0 0 10px;">رضا الطالب عن المدرسة</h3>
    <label>اسم المدرسة <span class="req">*</span></label>
    <input id="s_school" value="الابتدائية السادسة والثلاثون بالخميس">
    <label>مثال إجابة بند 1</label>
    <select id="s_q1">
      <option value="">اختر</option><option>دائماً</option><option>غالباً</option><option>أحياناً</option><option>نادراً</option>
    </select>
    <button class="btn" type="button" id="s_submit">إرسال وحفظ</button>
  </section>

  <section id="parents" class="card" style="display:none">
    <h3 style="margin:0 0 10px;">رضا ولي الأمر</h3>
    <label>اسم المدرسة <span class="req">*</span></label>
    <input id="p_school" value="الابتدائية السادسة والثلاثون بالخميس">
    <label>مثال إجابة بند 1</label>
    <select id="p_q1">
      <option value="">اختر</option><option>دائماً</option><option>غالباً</option><option>أحياناً</option><option>نادراً</option>
    </select>
    <button class="btn" type="button" id="p_submit">إرسال وحفظ</button>
  </section>

  <section id="studentTeacher" class="card" style="display:none">
    <h3 style="margin:0 0 10px;">رضا الطالب عن المعلم</h3>
    <label>اسم المدرسة <span class="req">*</span></label>
    <input id="st_school" value="الابتدائية السادسة والثلاثون بالخميس">
    <label>مثال إجابة بند 1</label>
    <select id="st_q1">
      <option value="">اختر</option><option>دائماً</option><option>غالباً</option><option>أحياناً</option><option>نادراً</option>
    </select>
    <button class="btn" type="button" id="st_submit">إرسال وحفظ</button>
  </section>
</div>

<footer>تصميم/إعداد: بدرية الزهراني</footer>

<script>
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbwy098HrSJ1vqA_xNQQal3lCD6Z1-S0vi2Q8_XNVPKNH8B_TQZZiskueR99RwjGjncC/exec";

const okBox = document.getElementById("okBox");
const errBox = document.getElementById("errBox");
const form = document.getElementById("submitForm");
const payloadInput = document.getElementById("payloadInput");

function showOk(msg){ okBox.textContent=msg||"تم حفظ الاستجابة ✅"; okBox.style.display="block"; errBox.style.display="none"; setTimeout(()=>okBox.style.display="none",3500); }
function showErr(msg){ errBox.textContent=msg; errBox.style.display="block"; okBox.style.display="none"; setTimeout(()=>errBox.style.display="none",6500); }

function nowISO(){ return new Date().toISOString(); }
function getAnonId(){ let id=localStorage.getItem("anonId"); if(!id){ id="anon_"+Math.random().toString(16).slice(2)+"_"+Date.now().toString(16); localStorage.setItem("anonId",id);} return id; }
function meta(){ return {anonymousId:getAnonId(), ua:navigator.userAgent, lang:navigator.language, tz:Intl.DateTimeFormat().resolvedOptions().timeZone||null, page:location.pathname}; }

function setTab(view){
  document.querySelectorAll(".tab").forEach(b=>b.classList.toggle("active", b.dataset.view===view));
  ["impact","teachers","students","parents","studentTeacher"].forEach(id=>{
    document.getElementById(id).style.display = (id===view) ? "block" : "none";
  });
}
document.querySelectorAll(".tab").forEach(b=>b.addEventListener("click", ()=>setTab(b.dataset.view)));

function submitPayload(payload){
  payload.createdAt = nowISO();
  payload.meta = meta();
  form.action = APPS_SCRIPT_URL; // مهم
  payloadInput.value = JSON.stringify(payload);
  form.submit();
  showOk("تم إرسال الاستجابة ✅ (يُحفظ في الشيت)");
}

document.getElementById("impact_submit").addEventListener("click", ()=>{
  const school = document.getElementById("impact_school").value.trim();
  const program = document.getElementById("impact_program").value.trim();
  if(!school || !program){ showErr("اسم المدرسة واسم البرنامج مطلوبان."); return; }
  submitPayload({
    type:"impact",
    school, program,
    goalPct: Number(document.getElementById("impact_goalPct").value||0),
    effectPct: Number(document.getElementById("impact_effectPct").value||0),
    positives: document.getElementById("impact_positives").value.trim(),
    challenges: document.getElementById("impact_challenges").value.trim(),
  });
});

// أمثلة استبانات (بند واحد) — إذا تبين أرجعها كاملة 10/18 بند
document.getElementById("t_submit").addEventListener("click", ()=>{
  const school = document.getElementById("t_school").value.trim();
  if(!school){ showErr("اسم المدرسة مطلوب."); return; }
  submitPayload({ type:"teacher_satisfaction", school, answers:{ "1": document.getElementById("t_q1").value||null } });
});
document.getElementById("s_submit").addEventListener("click", ()=>{
  const school = document.getElementById("s_school").value.trim();
  if(!school){ showErr("اسم المدرسة مطلوب."); return; }
  submitPayload({ type:"student_school_satisfaction", school, answers:{ "1": document.getElementById("s_q1").value||null } });
});
document.getElementById("p_submit").addEventListener("click", ()=>{
  const school = document.getElementById("p_school").value.trim();
  if(!school){ showErr("اسم المدرسة مطلوب."); return; }
  submitPayload({ type:"parent_satisfaction", school, answers:{ "1": document.getElementById("p_q1").value||null } });
});
document.getElementById("st_submit").addEventListener("click", ()=>{
  const school = document.getElementById("st_school").value.trim();
  if(!school){ showErr("اسم المدرسة مطلوب."); return; }
  submitPayload({ type:"student_teacher_satisfaction", school, answers:{ "1": document.getElementById("st_q1").value||null } });
});
</script>
</body>
</html>
