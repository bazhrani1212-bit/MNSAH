<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±Ø© â€” Ù†ØªØ§Ø¦Ø¬ Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø«Ø±</title>
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI",Tahoma,Arial; margin:0; background:#f6f7fb;}
    header{background:#334155; color:#fff; padding:14px 12px;}
    .wrap{max-width:1200px; margin:0 auto; padding:14px;}
    .brand{display:flex; flex-direction:column; gap:6px;}
    .brand h1{margin:0; font-size:18px; font-weight:900;}
    .brand .sub{opacity:.95; font-size:13px; line-height:1.5;}
    .card{background:#fff; border-radius:14px; padding:14px; box-shadow:0 1px 8px rgba(0,0,0,.06); margin:10px 0;}
    .btn{border:0; background:#0f766e; color:#fff; padding:10px 12px; border-radius:12px; cursor:pointer; font-weight:900}
    .btn.gray{background:#475569}
    .btn.light{background:#64748b}
    input,select{padding:10px; border-radius:10px; border:1px solid #d0d7de; width:100%}
    .row{display:grid; grid-template-columns:1fr 1fr 1fr 1fr; gap:10px}
    @media(max-width:1100px){.row{grid-template-columns:1fr 1fr}}
    @media(max-width:700px){.row{grid-template-columns:1fr}}
    table{width:100%; border-collapse:collapse; font-size:13px}
    th,td{border-bottom:1px solid #eef2f7; padding:10px; text-align:right; vertical-align:top}
    th{background:#f1f5f9}
    .hint{color:#64748b; font-size:12px}
    .ok{background:#ecfdf5; border:1px solid #10b981; color:#065f46; padding:10px; border-radius:12px; display:none}
    .err{background:#fef2f2; border:1px solid #ef4444; color:#7f1d1d; padding:10px; border-radius:12px; display:none}
    footer{padding:18px 12px; color:#64748b; font-size:12px; text-align:center}
    .actions{display:flex; gap:10px; flex-wrap:wrap; align-items:center}
    .tag{display:inline-block; padding:4px 10px; border-radius:999px; background:#e2e8f0; font-size:12px; margin:2px 4px 2px 0;}
    .mini{font-size:12px; color:#64748b}
    .linklike{color:#0f766e; font-weight:900; cursor:pointer; text-decoration:underline}

    /* Modal */
    .backdrop{position:fixed; inset:0; background:rgba(15,23,42,.55); display:none; align-items:center; justify-content:center; padding:14px; z-index:9999;}
    .modal{max-width:900px; width:100%; background:#fff; border-radius:16px; box-shadow:0 12px 40px rgba(0,0,0,.25); overflow:hidden;}
    .modalHead{display:flex; align-items:center; justify-content:space-between; padding:12px 14px; background:#f1f5f9; border-bottom:1px solid #e2e8f0;}
    .modalHead .title{font-weight:900}
    .closeX{border:0; background:transparent; font-size:20px; cursor:pointer; padding:4px 8px; line-height:1;}
    .modalBody{padding:14px; max-height:72vh; overflow:auto;}
    .grid2{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    @media(max-width:800px){.grid2{grid-template-columns:1fr;}}
    .field{background:#fff; border:1px solid #eef2f7; border-radius:12px; padding:10px;}
    .field .k{font-size:12px; color:#64748b; margin-bottom:6px;}
    .field .v{font-size:14px; white-space:pre-wrap; word-break:break-word;}
    .pill{display:inline-block; padding:4px 10px; border-radius:999px; background:#e6fffb; border:1px solid #99f6e4; margin:2px 4px 2px 0; font-size:12px;}
    .mono{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace; font-size:12px;}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">
      <h1>Ù„ÙˆØ­Ø© Ø§Ù„Ù…Ø¯ÙŠØ±Ø© â€” Ù…Ù†ØµØ© Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø«Ø± ÙˆØ±Ø¶Ø§ Ø§Ù„Ù…Ø³ØªÙÙŠØ¯</h1>
      <div class="sub">
        Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: <b>Ø§Ù„Ø§Ø¨ØªØ¯Ø§Ø¦ÙŠØ© Ø§Ù„Ø³Ø§Ø¯Ø³Ø© ÙˆØ§Ù„Ø«Ù„Ø§Ø«ÙˆÙ† Ø¨Ø§Ù„Ø®Ù…ÙŠØ³</b> â€” Ù…Ø¯ÙŠØ±Ø© Ø§Ù„Ù…Ø¯Ø±Ø³Ø©: <b>Ù†ÙˆØ±Ø© Ø§Ù„Ø±ÙØ§Ø¹ÙŠ</b><br>
        Ø¹Ø±Ø¶ Ù…Ø¨Ø§Ø´Ø± Ù…Ù† Google Sheet (ÙŠØªØ·Ù„Ø¨ Admin Token).
      </div>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="ok" id="okBox"></div>
  <div class="err" id="errBox"></div>

  <div class="card">
    <div class="actions">
      <a class="btn gray" href="index.html">Ø§Ù„Ø¹ÙˆØ¯Ø© Ù„Ù„Ù†Ù…Ø§Ø°Ø¬</a>
      <button class="btn" id="loadBtn">ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬</button>
      <button class="btn gray" id="exportCsvBtn">ØªØµØ¯ÙŠØ± CSV</button>
    </div>
    <div class="hint" style="margin-top:10px" id="statusLine">â³ ÙØ­Øµ Ø§Ù„Ø§ØªØµØ§Ù„â€¦</div>
  </div>

  <div class="card">
    <div class="row">
      <div>
        <label class="hint">Admin Token</label>
        <input id="tokenInput" placeholder="Ø§Ù„ØªÙˆÙƒÙ† Ø§Ù„Ù…ÙˆØ¬ÙˆØ¯ ÙÙŠ ÙˆØ±Ù‚Ø© settings Ø¯Ø§Ø®Ù„ Google Sheet" />
      </div>
      <div>
        <label class="hint">Ø§Ù„Ù†ÙˆØ¹</label>
        <select id="typeFilter">
          <option value="">Ø§Ù„ÙƒÙ„</option>
          <option value="impact">Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø«Ø±</option>
          <option value="teacher_satisfaction">Ø±Ø¶Ø§ Ø§Ù„Ù…Ø¹Ù„Ù…</option>
          <option value="student_school_satisfaction">Ø±Ø¶Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù† Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</option>
          <option value="parent_satisfaction">Ø±Ø¶Ø§ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±</option>
          <option value="student_teacher_satisfaction">Ø±Ø¶Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù† Ø§Ù„Ù…Ø¹Ù„Ù…</option>
        </select>
      </div>
      <div>
        <label class="hint">Ø¨Ø­Ø« Ù†ØµÙŠ</label>
        <input id="searchText" placeholder="Ø¹Ù„ÙˆÙ… / Ø¨Ø±Ù†Ø§Ù…Ø¬ / Ø£Ø«Ø± ..." />
      </div>
      <div>
        <label class="hint">Ø§Ù„Ø­Ø¯</label>
        <select id="limitSel">
          <option value="200">200</option>
          <option value="500" selected>500</option>
          <option value="1000">1000</option>
          <option value="2000">2000</option>
        </select>
      </div>
    </div>
    <div class="hint" style="margin-top:10px;">
      ğŸ’¡ Ø§Ø¶ØºØ·ÙŠ â€œØ¹Ø±Ø¶â€ Ù„ÙØªØ­ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø© ÙƒÙ†Ù…ÙˆØ°Ø¬ ÙÙŠ ØµÙØ­Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©.
    </div>
  </div>

  <div class="card">
    <div class="hint" id="summaryLine">â€”</div>
    <div style="overflow:auto; margin-top:10px">
      <table>
        <thead>
          <tr>
            <th>Ø§Ù„Ù†ÙˆØ¹</th>
            <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
            <th>Ø§Ù„Ù…Ø¯Ø±Ø³Ø©</th>
            <th>Ù…Ø®ØªØµØ±</th>
            <th>Ø¹Ø±Ø¶</th>
          </tr>
        </thead>
        <tbody id="rows"></tbody>
      </table>
    </div>
  </div>
</div>

<footer>ØªØµÙ…ÙŠÙ…/Ø¥Ø¹Ø¯Ø§Ø¯: Ø¨Ø¯Ø±ÙŠØ© Ø§Ù„Ø²Ù‡Ø±Ø§Ù†ÙŠ</footer>

<!-- Modal -->
<div class="backdrop" id="backdrop" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true" aria-labelledby="modalTitle">
    <div class="modalHead">
      <div class="title" id="modalTitle">Ø¹Ø±Ø¶ Ø§Ù„Ø§Ø³ØªØ¬Ø§Ø¨Ø©</div>
      <button class="closeX" id="closeX" title="Ø¥ØºÙ„Ø§Ù‚">âœ•</button>
    </div>
    <div class="modalBody" id="modalBody"></div>
  </div>
</div>

<script>
/** Ø±Ø§Ø¨Ø· Web App */
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyZBgj7Qomh3858lXJWripmkFlKW_bcUD8POm7XXCuk6nAQJAc6EPZdFu8YOciaMdUM/exec";

/** UI */
const okBox = document.getElementById('okBox');
const errBox = document.getElementById('errBox');
const statusLine = document.getElementById('statusLine');
const rowsEl = document.getElementById("rows");
const summaryLine = document.getElementById("summaryLine");

const tokenInput = document.getElementById("tokenInput");
const typeFilter = document.getElementById("typeFilter");
const searchText = document.getElementById("searchText");
const limitSel = document.getElementById("limitSel");

let allData = [];

function showOk(msg){ okBox.textContent=msg; okBox.style.display='block'; errBox.style.display='none'; setTimeout(()=>okBox.style.display='none', 3500); }
function showErr(msg){ errBox.textContent=msg; errBox.style.display='block'; okBox.style.display='none'; setTimeout(()=>errBox.style.display='none', 6500); }
function esc(s){ return (s??"").toString().replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;"); }

function fmtType(t){
  const map={
    impact:"Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø«Ø±",
    teacher_satisfaction:"Ø±Ø¶Ø§ Ø§Ù„Ù…Ø¹Ù„Ù…",
    student_school_satisfaction:"Ø±Ø¶Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù† Ø§Ù„Ù…Ø¯Ø±Ø³Ø©",
    parent_satisfaction:"Ø±Ø¶Ø§ ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±",
    student_teacher_satisfaction:"Ø±Ø¶Ø§ Ø§Ù„Ø·Ø§Ù„Ø¨ Ø¹Ù† Ø§Ù„Ù…Ø¹Ù„Ù…"
  };
  return map[t]||t;
}

function safeJsonParse(v){
  if(v == null) return null;
  if(typeof v === "object") return v;
  const s = String(v).trim();
  if(!s) return null;
  try{ return JSON.parse(s); }catch{ return null; }
}

function rowBrief(x){
  if(x.type==="impact"){
    const tags=[
      x.program?`Ø¨Ø±Ù†Ø§Ù…Ø¬: ${x.program}`:null,
      x.impactLevel?`Ø§Ù„Ø£Ø«Ø±: ${x.impactLevel}`:null,
      (x.effectPct!=="" && x.effectPct!=null)?`%Ø§Ù„Ø£Ø«Ø±: ${x.effectPct}`:null
    ].filter(Boolean);
    return tags.map(t=>`<span class="tag">${esc(t)}</span>`).join('');
  }
  // Ø§Ø³ØªØ¨Ø§Ù†Ø§Øª
  let answered = 0;
  const ans = safeJsonParse(x.answers);
  if(ans) answered = Object.values(ans).filter(Boolean).length;
  const tags=[`Ø¨Ù†ÙˆØ¯ Ù…Ø¬Ø§Ø¨Ø©: ${answered}`, x.subject?`Ù…Ø§Ø¯Ø©: ${x.subject}`:null, x.grade?`ØµÙ: ${x.grade}`:null].filter(Boolean);
  return tags.map(t=>`<span class="tag">${esc(t)}</span>`).join('');
}

async function ping(){
  const r = await fetch(`${APPS_SCRIPT_URL}?action=ping`);
  const j = await r.json();
  return !!j?.ok;
}

async function loadFromSheet(){
  const token = (tokenInput.value || "").trim();
  if(!token){ showErr("Ø¶Ø¹ÙŠ Admin Token Ø£ÙˆÙ„Ù‹Ø§."); return; }

  const type = (typeFilter.value || "").trim();
  const q = (searchText.value || "").trim();
  const limit = Number(limitSel.value||500);

  const u = new URL(APPS_SCRIPT_URL);
  u.searchParams.set("action","list");
  u.searchParams.set("token", token);
  u.searchParams.set("limit", String(limit));
  if(type) u.searchParams.set("type", type);
  if(q) u.searchParams.set("q", q);

  try{
    const res = await fetch(u.toString());
    const json = await res.json();
    if(!json.ok){
      if(json.error === "UNAUTHORIZED") { showErr("ØªÙˆÙƒÙ† ØºÙŠØ± ØµØ­ÙŠØ­ (settings â†’ ADMIN_TOKEN)."); return; }
      throw new Error(json.error || "LOAD_FAILED");
    }
    allData = json.data || [];
    renderTable();
    showOk("ØªÙ… ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ âœ…");
  }catch(e){
    console.error(e);
    showErr("ØªØ¹Ø°Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ù†ØªØ§Ø¦Ø¬. ØªØ­Ù‚Ù‚ÙŠ Ù…Ù†: Ù†Ø´Ø± Web App (Anyone) + Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ§Øª.");
  }
}

function renderTable(){
  summaryLine.textContent = `Ø¹Ø¯Ø¯ Ø§Ù„Ù†ØªØ§Ø¦Ø¬ Ø§Ù„Ù…Ø¹Ø±ÙˆØ¶Ø©: ${allData.length}`;
  rowsEl.innerHTML = allData.map((x,idx)=>`
    <tr>
      <td>${esc(fmtType(x.type))}</td>
      <td class="mini">${esc(x.createdAt||"")}</td>
      <td>${esc(x.school||"â€”")}</td>
      <td>${rowBrief(x)}</td>
      <td><span class="linklike" data-i="${idx}">Ø¹Ø±Ø¶</span></td>
    </tr>
  `).join('');
  rowsEl.querySelectorAll('[data-i]').forEach(el=>{
    el.addEventListener('click', ()=>{
      const i = Number(el.getAttribute('data-i'));
      openModal(allData[i]);
    });
  });
}

function exportCsv(){
  if(!allData.length){ showErr("Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬ Ù„ØªØµØ¯ÙŠØ±Ù‡Ø§."); return; }
  const cols = Object.keys(allData[0]);
  const lines = [cols.join(",")];
  allData.forEach(x=>{
    const row = cols.map(c => `"${String(x[c]??"").replaceAll('"','""')}"`);
    lines.push(row.join(","));
  });
  const blob = new Blob([lines.join("\n")], {type:"text/csv;charset=utf-8"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url; a.download = "admin_view.csv"; a.click();
  URL.revokeObjectURL(url);
}

/** ===== Modal (ØµÙØ­Ø© Ù…Ù†Ø¨Ø«Ù‚Ø©) ===== */
const backdrop = document.getElementById("backdrop");
const modalBody = document.getElementById("modalBody");
const modalTitle = document.getElementById("modalTitle");
const closeX = document.getElementById("closeX");

function openModal(x){
  modalTitle.textContent = `Ø§Ø³ØªØ¬Ø§Ø¨Ø© â€” ${fmtType(x.type)} â€” ${x.createdAt || ""}`;

  // ØªØ¬Ù‡ÙŠØ² Ø£Ù‚Ø³Ø§Ù… Ø­Ø³Ø¨ Ø§Ù„Ù†ÙˆØ¹
  const tools = safeJsonParse(x.tools) || (typeof x.tools === "string" ? safeJsonParse(x.tools) : null);
  const evidence = safeJsonParse(x.evidenceLinks) || (typeof x.evidenceLinks === "string" ? safeJsonParse(x.evidenceLinks) : null);
  const answers = safeJsonParse(x.answers);
  const meta = safeJsonParse(x.meta);

  const fields = [];

  // Ø­Ù‚ÙˆÙ„ Ø¹Ø§Ù…Ø©
  fields.push(["ID", x.id]);
  fields.push(["Ø§Ù„ØªØ§Ø±ÙŠØ®", x.createdAt]);
  fields.push(["Ø§Ù„Ù…Ø¯Ø±Ø³Ø©", x.school]);
  fields.push(["Ø§Ù„Ù†ÙˆØ¹", fmtType(x.type)]);

  if(x.type === "impact"){
    fields.push(["Ø§Ø³Ù… Ø§Ù„Ø¨Ø±Ù†Ø§Ù…Ø¬", x.program]);
    fields.push(["Ø§Ù„Ù…Ø¬Ø§Ù„", x.domain]);
    fields.push(["Ø§Ù„Ù…Ø³ØªÙ‡Ø¯ÙÙˆÙ†", x.targets]);
    fields.push(["Ø§Ù„Ø£Ø¯Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…", x.performance]);
    fields.push(["Ù…Ø³ØªÙˆÙ‰ Ø§Ù„Ø£Ø«Ø±", x.impactLevel]);
    fields.push(["Ù†Ø³Ø¨Ø© ØªØ­Ù‚Ù‚ Ø§Ù„Ø£Ù‡Ø¯Ø§Ù", x.goalPct]);
    fields.push(["Ø§Ù„Ù†Ø³Ø¨Ø© Ø§Ù„Ù…Ø¦ÙˆÙŠØ© Ù„Ù„Ø£Ø«Ø±", x.effectPct]);
    fields.push(["Ø£Ø³Ù„ÙˆØ¨ Ø§Ù„ØªÙ†ÙÙŠØ°", x.method]);
    fields.push(["ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ†ÙÙŠØ°", x.date]);
    fields.push(["Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹", x.week]);
    fields.push(["Ø¹Ø¯Ø¯ Ø§Ù„Ø·Ù„Ø§Ø¨/Ø§Ù„Ø·Ø§Ù„Ø¨Ø§Øª", x.nStudents]);
    fields.push(["Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø¹Ù„Ù…ÙŠÙ†/Ø§Ù„Ù…Ø¹Ù„Ù…Ø§Øª", x.nTeachers]);
    fields.push(["Ø¹Ø¯Ø¯ Ø£ÙˆÙ„ÙŠØ§Ø¡ Ø§Ù„Ø£Ù…ÙˆØ±", x.nParents]);
    fields.push(["Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù„Ø¬Ù†Ø©", x.committee]);
    fields.push(["Ø§Ù„Ø¥ÙŠØ¬Ø§Ø¨ÙŠØ§Øª", x.positives]);
    fields.push(["Ø§Ù„ØµØ¹ÙˆØ¨Ø§Øª", x.challenges]);
  } else if(x.type === "teacher_satisfaction"){
    fields.push(["Ø§Ø³Ù… Ø§Ù„Ù…Ø¹Ù„Ù…", x.name]);
    fields.push(["Ù…Ù„Ø§Ø­Ø¸Ø§Øª", x.notes]);
  } else if(x.type === "student_school_satisfaction"){
    fields.push(["Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨", x.name]);
    fields.push(["Ø§Ù„ØµÙ", x.grade]);
    fields.push(["Ù…Ù„Ø§Ø­Ø¸Ø§Øª", x.notes]);
  } else if(x.type === "parent_satisfaction"){
    fields.push(["Ø§Ø³Ù… ÙˆÙ„ÙŠ Ø§Ù„Ø£Ù…Ø±", x.parentName]);
    fields.push(["Ø§Ù„Ù…Ø¤Ù‡Ù„", x.education]);
    fields.push(["Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨/Ø§Ù„Ø·Ø§Ù„Ø¨Ø©", x.studentName]);
    fields.push(["Ù…Ù„Ø§Ø­Ø¸Ø§Øª", x.notes]);
  } else if(x.type === "student_teacher_satisfaction"){
    fields.push(["Ø§Ø³Ù… Ø§Ù„Ø·Ø§Ù„Ø¨", x.name]);
    fields.push(["Ø§Ù„ØµÙ", x.grade]);
    fields.push(["Ø§Ù„Ù…Ø§Ø¯Ø©", x.subject]);
    fields.push(["Ù…Ù„Ø§Ø­Ø¸Ø§Øª", x.notes]);
  }

  const toolsHtml = Array.isArray(tools) && tools.length
    ? tools.map(t=>`<span class="pill">${esc(t)}</span>`).join('')
    : `<span class="mini">â€”</span>`;

  const evidenceHtml = Array.isArray(evidence) && evidence.length
    ? `<div>${evidence.map(u=>`<div class="mono">â€¢ ${esc(u)}</div>`).join('')}</div>`
    : `<span class="mini">â€”</span>`;

  const answersHtml = answers && typeof answers === "object"
    ? `<div style="margin-top:10px">
         <div class="mini" style="margin-bottom:6px; font-weight:900">Ø¥Ø¬Ø§Ø¨Ø§Øª Ø§Ù„Ø¨Ù†ÙˆØ¯</div>
         ${Object.entries(answers).map(([k,v])=>`
            <div class="field">
              <div class="k">Ø§Ù„Ø¨Ù†Ø¯ ${esc(k)}</div>
              <div class="v">${esc(v || "â€”")}</div>
            </div>
         `).join('')}
       </div>`
    : `<span class="mini">â€”</span>`;

  const metaHtml = meta && typeof meta === "object"
    ? `<div class="field">
         <div class="k">Ù…Ø¹Ù„ÙˆÙ…Ø§Øª Ø§Ù„Ø¬Ù‡Ø§Ø² (meta)</div>
         <div class="v mono">${esc(JSON.stringify(meta, null, 2))}</div>
       </div>`
    : ``;

  modalBody.innerHTML = `
    <div class="grid2">
      ${fields.filter(([_,v])=>v!==undefined && v!==null && String(v).trim()!=="").map(([k,v])=>`
        <div class="field">
          <div class="k">${esc(k)}</div>
          <div class="v">${esc(v)}</div>
        </div>
      `).join('')}
      <div class="field">
        <div class="k">Ø£Ø¯ÙˆØ§Øª Ù‚ÙŠØ§Ø³ Ø§Ù„Ø£Ø«Ø±</div>
        <div class="v">${toolsHtml}</div>
      </div>
      <div class="field">
        <div class="k">Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø´ÙˆØ§Ù‡Ø¯</div>
        <div class="v">${evidenceHtml}</div>
      </div>
    </div>

    ${answersHtml}
    ${metaHtml}
  `;

  backdrop.style.display = "flex";
  backdrop.setAttribute("aria-hidden","false");
}

function closeModal(){
  backdrop.style.display = "none";
  backdrop.setAttribute("aria-hidden","true");
  modalBody.innerHTML = "";
}

closeX.addEventListener("click", closeModal);
backdrop.addEventListener("click", (e)=>{
  if(e.target === backdrop) closeModal(); // Ø¥ØºÙ„Ø§Ù‚ Ø¹Ù†Ø¯ Ø§Ù„Ø¶ØºØ· Ø®Ø§Ø±Ø¬ Ø§Ù„Ù…ÙˆØ¯Ø§Ù„
});
document.addEventListener("keydown", (e)=>{
  if(e.key === "Escape" && backdrop.style.display === "flex") closeModal();
});

document.getElementById("loadBtn").addEventListener("click", loadFromSheet);
document.getElementById("exportCsvBtn").addEventListener("click", exportCsv);

/** Status */
(async ()=>{
  try{
    const ok = await ping();
    statusLine.textContent = ok ? "âœ… Ø§Ù„Ø§ØªØµØ§Ù„ Ø¬Ø§Ù‡Ø²" : "âš ï¸ Ù„Ù… ÙŠØªÙ… ØªØ£ÙƒÙŠØ¯ Ø§Ù„Ø§ØªØµØ§Ù„";
  }catch{
    statusLine.textContent = "âŒ ØªØ¹Ø°Ø± Ø§Ù„Ø§ØªØµØ§Ù„ â€” Ø±Ø§Ø¬Ø¹ÙŠ Ø§Ù„Ù†Ø´Ø± Web App (Anyone) ÙˆØ§Ù„Ø±Ø§Ø¨Ø·";
  }
})();
</script>
</body>
</html>
