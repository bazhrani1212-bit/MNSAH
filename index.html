<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ููุตุฉ ููุงุณ ุงูุฃุซุฑ ูุฑุถุง ุงููุณุชููุฏ</title>
  <style>
    body{font-family:system-ui,-apple-system,"Segoe UI",Tahoma,Arial; margin:0; background:#f6f7fb; color:#111;}
    header{background:#0f766e; color:#fff; padding:14px 12px;}
    .wrap{max-width:980px; margin:0 auto; padding:14px;}
    .brand{display:flex; flex-direction:column; gap:6px;}
    .brand h1{margin:0; font-size:20px; font-weight:900;}
    .brand .sub{opacity:.95; font-size:13px; line-height:1.5;}
    .tabs{display:flex; gap:8px; flex-wrap:wrap; margin:12px 0;}
    .tab{border:0; padding:10px 12px; border-radius:10px; background:#fff; cursor:pointer; box-shadow:0 1px 4px rgba(0,0,0,.06)}
    .tab.active{background:#e6fffb; outline:2px solid #14b8a6;}
    .card{background:#fff; border-radius:14px; padding:14px; box-shadow:0 1px 8px rgba(0,0,0,.06); margin:10px 0;}
    label{display:block; margin:10px 0 6px; font-weight:700; font-size:14px;}
    input,select,textarea{width:100%; padding:10px; border-radius:10px; border:1px solid #d0d7de; font-size:14px; background:#fff;}
    textarea{min-height:90px; resize:vertical;}
    .row{display:grid; grid-template-columns:1fr 1fr; gap:10px;}
    @media (max-width:720px){.row{grid-template-columns:1fr;}}
    .btn{border:0; background:#0f766e; color:#fff; padding:12px 14px; border-radius:12px; cursor:pointer; font-weight:900}
    .btn.secondary{background:#334155}
    .btn:disabled{opacity:.55; cursor:not-allowed}
    .hint{font-size:12px; color:#475569; margin-top:6px}
    .ok{background:#ecfdf5; border:1px solid #10b981; color:#065f46; padding:10px; border-radius:12px; display:none; margin:10px 0}
    .err{background:#fef2f2; border:1px solid #ef4444; color:#7f1d1d; padding:10px; border-radius:12px; display:none; margin:10px 0}
    .scale{display:flex; gap:10px; flex-wrap:wrap}
    .pill{display:flex; align-items:center; gap:6px; padding:8px 10px; border:1px solid #d0d7de; border-radius:999px}
    footer{padding:18px 12px; color:#64748b; font-size:12px; text-align:center}
    .small{font-size:12px;color:#64748b}
    .req{color:#dc2626; font-weight:900}
  </style>
</head>
<body>
<header>
  <div class="wrap">
    <div class="brand">
      <h1>ููุตุฉ ููุงุณ ุงูุฃุซุฑ ูุฑุถุง ุงููุณุชููุฏ</h1>
      <div class="sub">
        ุงููุฏุฑุณุฉ: <b>ุงูุงุจุชุฏุงุฆูุฉ ุงูุณุงุฏุณุฉ ูุงูุซูุงุซูู ุจุงูุฎููุณ</b> โ ูุฏูุฑุฉ ุงููุฏุฑุณุฉ: <b>ููุฑุฉ ุงูุฑูุงุนู</b><br>
        ุชูุญูุธ ุงูุงุณุชุฌุงุจุงุช ูุจุงุดุฑุฉ ูู Google Sheet (ุจุฏูู Firebase).
      </div>
    </div>
  </div>
</header>

<div class="wrap">
  <div class="card">
    <div class="small">๐ ุงูุฎุตูุตูุฉ: ุงูุงุณู ุงุฎุชูุงุฑู โ ููุถูู ุนุฏู ูุชุงุจุฉ ุฃุณูุงุก ูุงููุฉ.</div>
    <div class="hint" id="statusLine">โณ ูุญุต ุงูุงุชุตุงูโฆ</div>
    <a class="btn secondary" href="admin.html">ููุญุฉ ุงููุฏูุฑุฉ</a>
  </div>

  <div class="tabs">
    <button class="tab active" data-view="impact">ููุงุณ ุฃุซุฑ ุจุฑูุงูุฌ</button>
    <button class="tab" data-view="teachers">ุฑุถุง ุงููุนูู ุนู ุฅุฏุงุฑุฉ ุงููุฏุฑุณุฉ</button>
    <button class="tab" data-view="students">ุฑุถุง ุงูุทุงูุจ ุนู ุงููุฏุฑุณุฉ</button>
    <button class="tab" data-view="parents">ุฑุถุง ููู ุงูุฃูุฑ ุนู ุงููุฏุฑุณุฉ</button>
    <button class="tab" data-view="studentTeacher">ุฑุถุง ุงูุทุงูุจ ุนู ุงููุนูู</button>
  </div>

  <div class="ok" id="okBox">ุชู ุญูุธ ุงูุงุณุชุฌุงุจุฉ ุจูุฌุงุญ โ</div>
  <div class="err" id="errBox"></div>

  <!-- ===== ููุงุณ ุงูุฃุซุฑ ===== -->
  <section id="impact" class="card">
    <h2 style="margin:0 0 6px;">ููุงุณ ุฃุซุฑ ุจุฑูุงูุฌ</h2>

    <div class="row">
      <div>
        <label>ุงุณู ุงููุฏุฑุณุฉ <span class="req">*</span></label>
        <input id="impact_school" value="ุงูุงุจุชุฏุงุฆูุฉ ุงูุณุงุฏุณุฉ ูุงูุซูุงุซูู ุจุงูุฎููุณ" />
      </div>
      <div>
        <label>ุงุณู ุงูุจุฑูุงูุฌ <span class="req">*</span></label>
        <input id="impact_program" placeholder="ูุซุงู: ุชุนุฒูุฒ ุงูุณููู ุงูุฅูุฌุงุจู" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>ุงููุฌุงู</label>
        <select id="impact_domain">
          <option value="">ุงุฎุชุฑ</option>
          <option>ููุณู</option>
          <option>ุชุฑุจูู</option>
          <option>ุงุฌุชูุงุนู</option>
          <option>ูููู</option>
        </select>
      </div>
      <div>
        <label>ุงููุณุชูุฏููู</label>
        <input id="impact_targets" placeholder="ุทูุงุจ/ุทุงูุจุงุชุ ูุนููููุ ุฃูููุงุก ุฃููุฑ..." />
      </div>
    </div>

    <div class="row">
      <div>
        <label>ุงูุฃุฏุงุก ุงูุนุงู ููุจุฑูุงูุฌ</label>
        <select id="impact_perf">
          <option value="">ุงุฎุชุฑ</option>
          <option>ุฌูุฏ</option>
          <option>ููุจูู</option>
          <option>ุถุนูู</option>
        </select>
      </div>
      <div>
        <label>ูุณุชูู ุงูุฃุซุฑ</label>
        <select id="impact_level">
          <option value="">ุงุฎุชุฑ</option>
          <option>ุชุฃุซูุฑ ููุญูุธ</option>
          <option>ุทููู</option>
          <option>ูุง ููุฌุฏ</option>
        </select>
      </div>
    </div>

    <div class="row">
      <div>
        <label>ูุณุจุฉ ุชุญูู ุงูุฃูุฏุงู (0 - 100)</label>
        <input id="impact_goalPct" type="number" min="0" max="100" placeholder="ูุซุงู: 85" />
      </div>
      <div>
        <label>ุงููุณุจุฉ ุงููุฆููุฉ ููุฃุซุฑ (0 - 100)</label>
        <input id="impact_effectPct" type="number" min="0" max="100" placeholder="ูุซุงู: 78" />
      </div>
    </div>

    <label>ุฃุฏูุงุช ููุงุณ ุงูุฃุซุฑ</label>
    <div class="scale" id="impact_tools">
      <label class="pill"><input type="checkbox" value="ุงูุงุณุชุจุงูุงุช"> ุงูุงุณุชุจุงูุงุช</label>
      <label class="pill"><input type="checkbox" value="ุงูููุงุญุธุฉ ุงููุจุงุดุฑุฉ"> ุงูููุงุญุธุฉ ุงููุจุงุดุฑุฉ</label>
      <label class="pill"><input type="checkbox" value="ุงูููุงุจูุงุช"> ุงูููุงุจูุงุช</label>
      <label class="pill"><input type="checkbox" value="ุฃุฎุฑู"> ุฃุฎุฑู</label>
    </div>

    <label>ุฃุณููุจ ุงูุชูููุฐ</label>
    <select id="impact_method">
      <option value="">ุงุฎุชุฑ</option>
      <option>ููุงุก</option>
      <option>ูุฑุดุฉ ุนูู</option>
      <option>ููุงุฏ ุฅุนูุงููุฉ</option>
      <option>ุฒูุงุฑุฉ ุฎุงุฑุฌูุฉ</option>
      <option>ูุนุฑุถ</option>
      <option>ูุณุงุจูุฉ</option>
      <option>ุฃุฎุฑู</option>
    </select>

    <div class="row">
      <div>
        <label>ุชุงุฑูุฎ ุงูุชูููุฐ</label>
        <input id="impact_date" type="date" />
      </div>
      <div>
        <label>ุงูุฃุณุจูุน</label>
        <input id="impact_week" placeholder="ูุซุงู: ุงูุฃุณุจูุน ุงูุซุงูุซ" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>ุนุฏุฏ ุงููุณุชููุฏูู: ุงูุทูุงุจ/ุงูุทุงูุจุงุช</label>
        <input id="impact_nStudents" type="number" min="0" placeholder="0" />
      </div>
      <div>
        <label>ุนุฏุฏ ุงููุณุชููุฏูู: ุงููุนูููู/ุงููุนููุงุช</label>
        <input id="impact_nTeachers" type="number" min="0" placeholder="0" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>ุนุฏุฏ ุงููุณุชููุฏูู: ุฃูููุงุก ุงูุฃููุฑ</label>
        <input id="impact_nParents" type="number" min="0" placeholder="0" />
      </div>
      <div>
        <label>ูุดุงุฑูุฉ ุฃุนุถุงุก ุงููุฌูุฉ</label>
        <select id="impact_committee">
          <option value="">ุงุฎุชุฑ</option>
          <option>ูุนู</option>
          <option>ูุง</option>
        </select>
      </div>
    </div>

    <label>ุงูุฅูุฌุงุจูุงุช</label>
    <textarea id="impact_positives"></textarea>

    <label>ุงูุตุนูุจุงุช ูู ุงูุชูููุฐ</label>
    <textarea id="impact_challenges"></textarea>

    <label>ุฑูุงุจุท ุงูุดูุงูุฏ (ูู ุฑุงุจุท ูู ุณุทุฑ)</label>
    <textarea id="impact_evidenceLinks"></textarea>

    <button class="btn" id="impact_submit">ุฅุฑุณุงู ูุญูุธ</button>
  </section>

  <!-- ===== ุฑุถุง ุงููุนูู ===== -->
  <section id="teachers" class="card" style="display:none">
    <h2 style="margin:0 0 6px;">ุงุณุชุจุงูุฉ ุฑุถุง ุงููุนูู ุนู ุฅุฏุงุฑุฉ ุงููุฏุฑุณุฉ</h2>
    <p class="hint">ุงูุฅุฌุงุจุงุช: ุฏุงุฆูุงู / ุบุงูุจุงู / ุฃุญูุงูุงู / ูุงุฏุฑุงู</p>

    <div class="row">
      <div>
        <label>ุงุณู ุงููุฏุฑุณุฉ <span class="req">*</span></label>
        <input id="t_school" value="ุงูุงุจุชุฏุงุฆูุฉ ุงูุณุงุฏุณุฉ ูุงูุซูุงุซูู ุจุงูุฎููุณ" />
      </div>
      <div>
        <label>ุงุณู ุงููุนูู (ุงุฎุชูุงุฑู)</label>
        <input id="t_name" />
      </div>
    </div>

    <div id="t_items"></div>

    <label>ููุงุญุธุงุช</label>
    <textarea id="t_notes"></textarea>

    <button class="btn" id="t_submit">ุฅุฑุณุงู ูุญูุธ</button>
  </section>

  <!-- ===== ุฑุถุง ุงูุทุงูุจ ุนู ุงููุฏุฑุณุฉ ===== -->
  <section id="students" class="card" style="display:none">
    <h2 style="margin:0 0 6px;">ุงุณุชุจุงูุฉ ุฑุถุง ุงูุทุงูุจ ุนู ุงููุฏุฑุณุฉ</h2>

    <div class="row">
      <div>
        <label>ุงุณู ุงููุฏุฑุณุฉ <span class="req">*</span></label>
        <input id="s_school" value="ุงูุงุจุชุฏุงุฆูุฉ ุงูุณุงุฏุณุฉ ูุงูุซูุงุซูู ุจุงูุฎููุณ" />
      </div>
      <div>
        <label>ุงูุตู</label>
        <input id="s_grade" placeholder="ูุซุงู: ุณุงุฏุณ/2" />
      </div>
    </div>

    <label>ุงุณู ุงูุทุงูุจ (ุงุฎุชูุงุฑู)</label>
    <input id="s_name" />

    <div id="s_items"></div>

    <label>ููุงุญุธุงุช</label>
    <textarea id="s_notes"></textarea>

    <button class="btn" id="s_submit">ุฅุฑุณุงู ูุญูุธ</button>
  </section>

  <!-- ===== ุฑุถุง ููู ุงูุฃูุฑ ===== -->
  <section id="parents" class="card" style="display:none">
    <h2 style="margin:0 0 6px;">ุงุณุชุจุงูุฉ ุฑุถุง ููู ุงูุฃูุฑ ุนู ุงููุฏุฑุณุฉ</h2>

    <label>ุงุณู ููู ุงูุฃูุฑ (ุงุฎุชูุงุฑู)</label>
    <input id="p_name" />
    <label>ุงููุคูู (ุงุฎุชูุงุฑู)</label>
    <input id="p_edu" />

    <div class="row">
      <div>
        <label>ุงุณู ุงููุฏุฑุณุฉ <span class="req">*</span></label>
        <input id="p_school" value="ุงูุงุจุชุฏุงุฆูุฉ ุงูุณุงุฏุณุฉ ูุงูุซูุงุซูู ุจุงูุฎููุณ" />
      </div>
      <div>
        <label>ุงุณู ุงูุทุงูุจ/ุงูุทุงูุจุฉ (ุงุฎุชูุงุฑู)</label>
        <input id="p_student" />
      </div>
    </div>

    <div id="p_items"></div>

    <label>ููุงุญุธุงุช</label>
    <textarea id="p_notes"></textarea>

    <button class="btn" id="p_submit">ุฅุฑุณุงู ูุญูุธ</button>
  </section>

  <!-- ===== ุฑุถุง ุงูุทุงูุจ ุนู ุงููุนูู ===== -->
  <section id="studentTeacher" class="card" style="display:none">
    <h2 style="margin:0 0 6px;">ุงุณุชุจุงูุฉ ุฑุถุง ุงูุทุงูุจ ุนู ุงููุนูู</h2>

    <div class="row">
      <div>
        <label>ุงุณู ุงููุฏุฑุณุฉ <span class="req">*</span></label>
        <input id="st_school" value="ุงูุงุจุชุฏุงุฆูุฉ ุงูุณุงุฏุณุฉ ูุงูุซูุงุซูู ุจุงูุฎููุณ" />
      </div>
      <div>
        <label>ุงููุงุฏุฉ</label>
        <input id="st_subject" placeholder="ูุซุงู: ุงูุนููู" />
      </div>
    </div>

    <div class="row">
      <div>
        <label>ุงูุตู</label>
        <input id="st_grade" />
      </div>
      <div>
        <label>ุงุณู ุงูุทุงูุจ (ุงุฎุชูุงุฑู)</label>
        <input id="st_name" />
      </div>
    </div>

    <div id="st_items"></div>

    <label>ููุงุญุธุงุช</label>
    <textarea id="st_notes"></textarea>

    <button class="btn" id="st_submit">ุฅุฑุณุงู ูุญูุธ</button>
  </section>
</div>

<footer>ุชุตููู/ุฅุนุฏุงุฏ: ุจุฏุฑูุฉ ุงูุฒูุฑุงูู</footer>

<script>
/** ุฑุงุจุท Web App (ููุซุจุช ููู) */
const APPS_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbyZBgj7Qomh3858lXJWripmkFlKW_bcUD8POm7XXCuk6nAQJAc6EPZdFu8YOciaMdUM/exec";

/** UI */
const okBox = document.getElementById('okBox');
const errBox = document.getElementById('errBox');
const statusLine = document.getElementById('statusLine');

function showOk(msg="ุชู ุญูุธ ุงูุงุณุชุฌุงุจุฉ ุจูุฌุงุญ โ"){
  okBox.textContent=msg; okBox.style.display='block'; errBox.style.display='none';
  setTimeout(()=>okBox.style.display='none', 3500);
}
function showErr(msg){
  errBox.textContent=msg; errBox.style.display='block'; okBox.style.display='none';
  setTimeout(()=>errBox.style.display='none', 6500);
}

function requiredFilled(...vals){ return vals.every(v => (v||"").trim().length>0); }
function getCheckedValues(containerId){
  return [...document.querySelectorAll(`#${containerId} input[type="checkbox"]:checked`)].map(x=>x.value);
}
function nowISO(){ return new Date().toISOString(); }
function getAnonId(){
  let id = localStorage.getItem("anonId");
  if(!id){ id = "anon_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16); localStorage.setItem("anonId", id); }
  return id;
}
function deviceMeta(){
  return { anonymousId:getAnonId(), ua:navigator.userAgent, lang:navigator.language, tz:Intl.DateTimeFormat().resolvedOptions().timeZone||null, page:location.pathname };
}

async function ping(){
  const r = await fetch(`${APPS_SCRIPT_URL}?action=ping`);
  const j = await r.json();
  return !!j?.ok;
}

async function postToSheet(payload){
  const res = await fetch(`${APPS_SCRIPT_URL}?action=submit`, {
    method: "POST",
    headers: {"Content-Type":"text/plain;charset=utf-8"},
    body: JSON.stringify(payload)
  });
  const json = await res.json().catch(()=>null);
  if(!json || !json.ok) throw new Error(json?.error || "SAVE_FAILED");
  return json;
}

/** Tabs */
const tabs = document.querySelectorAll('.tab');
tabs.forEach(btn=>{
  btn.addEventListener('click', ()=>{
    tabs.forEach(b=>b.classList.remove('active'));
    btn.classList.add('active');
    const view = btn.dataset.view;
    document.querySelectorAll('section.card').forEach(sec=>{
      if(['impact','teachers','students','parents','studentTeacher'].includes(sec.id)){
        sec.style.display = (sec.id===view)?'block':'none';
      }
    });
    window.scrollTo({top:0, behavior:"smooth"});
  });
});

/** Likert builders */
function buildLikertList(container, items){
  container.innerHTML = items.map((t,i)=>`
    <div style="padding:10px; border:1px solid #eef2f7; border-radius:12px; margin:10px 0;">
      <div style="font-weight:800; margin-bottom:6px;">${i+1}) ${t}</div>
      <select data-q="${i+1}">
        <option value="">ุงุฎุชุฑ</option>
        <option>ุฏุงุฆูุงู</option>
        <option>ุบุงูุจุงู</option>
        <option>ุฃุญูุงูุงู</option>
        <option>ูุงุฏุฑุงู</option>
      </select>
    </div>
  `).join('');
}
function readLikertAnswers(container){
  const selects = container.querySelectorAll('select[data-q]');
  const answers = {};
  selects.forEach(s=>{ answers[s.getAttribute('data-q')] = s.value || null; });
  return answers;
}

const teacherItems = [
  "ูุฏูุฑ ุงููุฏุฑุณุฉ ูุฑูุจ ูู ุงููุนูููู ููุนุงูููู ูุฃุฎูุฉ.","ูุนุฏู ูุฏูุฑ ุงููุฏุฑุณุฉ ูู ุชุนุงููู ุจูู ุงููุนูููู.","ูููู ูุฏูุฑ ุงููุฏุฑุณุฉ ุจุชูุฑูู ุงููุชููุฒูู ูู ุงููุนูููู.",
  "ููุฏุฑ ูุฏูุฑ ุงููุฏุฑุณุฉ ุธุฑูู ุงููุนูู ุฅุฐุง ุฃุฎุจุฑู ุจูุง.","ูุชูุญ ูุฏูุฑ ุงููุฏุฑุณุฉ ูููุนูููู ูุฑุตุง ูุชุทููุฑ ูุณุชูุงูู.","ูุดุฌุน ูุฏูุฑ ุงููุฏุฑุณุฉ ุงููุนูููู ุงูููุงุณุจูู ููุชูุฏู ููุนูู ุงูุฅุฏุงุฑู.",
  "ูุณุชุดูุฑ ูุฏูุฑ ุงููุฏุฑุณุฉ ุงููุนูููู ูุจู ุงุชุฎุงุฐ ูุฑุงุฑุงุชู.","ูููู ูุฏูุฑ ุงููุฏุฑุณุฉ ุจุฒูุงุฑุฉ ุงููุนูููู ุฒูุงุฑุฉ ุตููุฉ.","ูููู ูุฏูุฑ ุงููุฏุฑุณุฉ ุงููุนูููู ุชููููุง ุดุงููุง.",
  "ููุฒุน ูุฏูุฑ ุงููุฏุฑุณุฉ ุฃูุตุจุฉ ุงููุนูููู ุจุทุฑููุฉ ุนุงุฏูุฉ.","ููุฏู ูุฏูุฑ ุงููุฏุฑุณุฉ ููุงุญุธุงุชู ูุชูุฌููุงุชู ุจุทุฑููุฉ ููุงุณุจุฉ.","ููุซู ูุฏูุฑ ุงููุฏุฑุณุฉ ูุฏูุฉ ูู ุงูุงูุถุจุงุท ูู ุงูุนูู.",
  "ูุณุชุฎุฏู ูุฏูุฑ ุงููุฏุฑุณุฉ ุฃุณููุจ ุงูุซูุงุจ ูุงูุนูุงุจ.","ูุทูุน ูุฏูุฑ ุงููุฏุฑุณุฉ ุงููุนูููู ุนูู ุงูุชุนูููุงุช ูุงููุธู ุจุดูู ูุณุชูุฑ.","ุฃุฌุฏ ุฑุบุจุฉ ูู ูุณุงุนุฏุฉ ุงููุฏุฑุณุฉ ูู ุงูุฃุฒูุงุช.",
  "ูุง ุฃุฌุฏ ุญุฑุฌุง ูู ุงููุดุงุฑูุฉ ูู ุงูุฃูุดุทุฉ ุงููุงุตููุฉ ุฎุงุฑุฌ ููุช ุงูุฏูุงู.","ุฃุฑุบุจ ุจุฒูุงุฑุฉ ูุฏูุฑ ุงููุฏุฑุณุฉ ูู ุฒูุงุฑุฉ ุตููุฉ.","ุฃุฑุบุจ ุงูุงูุชูุงู ูู ุงููุฏุฑุณุฉ ุฅูู ูุฏุฑุณุฉ ุฃุฎุฑู."
];
const studentSchoolItems = [
  "ุชุนุชูู ุงููุฏุฑุณุฉ ุจุฑูุน ูุณุชูู ุชุญุตูู ุงูุทูุงุจ.","ุชุชูุญ ุงููุฏุฑุณุฉ ููุทูุงุจ ูุฑุต ุงูุชุดุงู ููุงูุจูู ููุฏุฑุงุชูู.","ุชูุชู ุงููุฏุฑุณุฉ ุจูุธุงูุฉ ุงููุตูู ููุธุงูุฉ ุงููุฏุฑุณุฉ ุจุดูู ุนุงู.",
  "ุชุฃุฎุฐ ุงููุฏุฑุณุฉ ุจุขุฑุงุก ุงูุทูุงุจ ูููุง ูุชุนูู ุจุงุญุชูุงุฌุงุชูู.","ุชูุชู ุงููุฏุฑุณุฉ ุจููุนูุฉ ุงููุฌุจุงุช ุงูููุฏูุฉ ูู ุงูููุตู ุงููุฏุฑุณู.","ุชูุฑู ุงููุฏุฑุณุฉ ุงูุทูุจุฉ ุงููุชููุฒูู ูุงููุชููููู.",
  "ุชููู ุงููุฏุฑุณุฉ ุงูููุงุดุท ุงููุงุตููุฉ ุฃุซูุงุก ุงูููู ุงูุฏุฑุงุณู ูุฎุงุฑุฌู.","ุชุนุชูู ุงููุฏุฑุณุฉ ุจุญู ุงููุดุงูู ุงูุชู ุชุนุชุฑุถ ุงูุทูุงุจ.","ุชุดุฑู ุงููุฏุฑุณุฉ ุงูุทูุงุจ ูู ุฅุฏุงุฑุฉ ุงูููู ุงูุฏุฑุงุณู.",
  "ูุณุชููุฏ ุงูุทูุงุจ ูู ูุงุนุฉ ูุตุงุฏุฑ ุงูุชุนูู ุงูููุฌูุฏุฉ ูู ุงููุฏุฑุณุฉ.","ุฃุดุนุฑ ุจุชูุงู ุงูุฑุงุญุฉ ูู ูุฏุฑุณุชู.","ุฃุชููู ุฃู ุฃูุชูู ุฅูู ูุฏุฑุณุฉ ุฃุฎุฑู."
];
const parentItems = [
  "ุชุชูุงุตู ุงููุฏุฑุณุฉ ูุน ุฃูููุงุก ุงูุฃููุฑ ููุดุงุฑูุชูู ูู ุฑุคูุฉ ุงููุฏุฑุณุฉ ูุฑุณุงูุชูุง.","ุฃุดุนุฑ ุจุงุญุชุฑุงู ูุชูุฏูุฑ ุงููุฏุฑุณุฉ ุนูุฏ ุชุนุงูููุง ูุนู (ูููู ุฃูุฑ ุทุงูุจ).",
  "ุฃูุงุญุธ ุฃู ุงููุฏุฑุณุฉ ุชุดุฌุน ุทูุงุจูุง ุนูู ุงูุชููุฒ ูู ุฌููุน ุงููุฌุงูุงุช.","ุชุชุงุญ ูู ูุฑุตุฉ ุงููุดุงุฑูุฉ ูุน ุงููุฏุฑุณุฉ ูู ุงูุนูููุฉ ุงูุชุนููููุฉ.",
  "ุชุญุฑุต ุงููุฏุฑุณุฉ ุนูู ูุดุงุฑูุฉ ุฃูููุงุก ุงูุฃููุฑ ูู ุงูุฑุนุงูุฉ ุงูุตุญูุฉ ูููุชุนูููู.","ุชุญุฑุต ุงููุฏุฑุณุฉ ุนูู ุชูุณูุฑ ุงูุชูุงุตู ุจูู ุงููุนูููู ูุงููุชุนูููู ูุฃูููุงุก ุงูุฃููุฑ ูู ุฎูุงู ุงููููุน ุงูุฅููุชุฑููู.",
  "ุชุณุชุฎุฏู ุงููุฏุฑุณุฉ ูุธุงูุงู ูุฅุนูุงู ุฃูููุงุก ุงูุฃููุฑ ุจูุณุชูู ุชูุฏู ุฃุฏุงุก ุฃุจูุงุฆูู.","ุชุญุฑุต ุงููุฏุฑุณุฉ ุนูู ูุดุงุฑูุฉ ุฃูููุงุก ุงูุฃููุฑ ูู ุชุทููุฑ ุงูุนูููุฉ ุงูุชุนููููุฉ.",
  "ุชูุดุฑ ุงููุฏุฑุณุฉ ุซูุงูุฉ ุงูุฅุฑุดุงุฏ ุงูุชุฑุจูู ูุงูููุณู ุจูู ุฃูููุงุก ุงูุฃููุฑ.","ุชููุฑ ุงููุฏุฑุณุฉ ูุฃูููุงุก ุฃููุฑ ุงูุทูุงุจ ุฃุฑูุงูุง ููุชูุงุตู (ุซุงุจุช โ ุฌูุงู)."
];
const studentTeacherItems = [
  "ูุญุฑุต ุงููุนูู ุนูู ุชูุถูุญ ุงูุฏุฑุณ ุจุทุฑููุฉ ููุงุณุจุฉ.","ููุชู ุงููุนูู ุจุชูุตูู ุงููุนูููุฉ ุฅูู ุงูุทุงูุจ.","ูุณุชุฎุฏู ุงููุนูู ุทุฑูุง ุญุฏูุซุฉ ููุชููุนุฉ ูู ุดุฑุญ ุงูุฏุฑูุณ.",
  "ูููุน ุงููุนูู ูู ุทุฑู ุชุฏุฑูุณู.","ูุนุชูู ุงููุนูู ุจุงููุณุงุฆู ุงูุชุนููููุฉ ุนูุฏ ุนุฑุถ ุงููุนูููุฉ.","ูุดุฌุน ุงููุนูู ุงูุทูุงุจ.",
  "ูุจุฐู ุงููุนูู ุฌูุฏู ูุฏูุน ุงูููู ูุงูุณุขูุฉ ุนู ุงูุทูุงุจ.","ูุฃุฎุฐ ุงููุนูู ุจุขุฑุงุก ุงูุทูุงุจ.","ูููู ุงููุนูู ูุน ุงูุทูุงุจ ุนูุงูุฉ ุตุฏุงูุฉ.","ููุชู ุงููุนูู ุจุญู ูุดุงูู ุงูุทูุงุจ."
];

buildLikertList(document.getElementById('t_items'), teacherItems);
buildLikertList(document.getElementById('s_items'), studentSchoolItems);
buildLikertList(document.getElementById('p_items'), parentItems);
buildLikertList(document.getElementById('st_items'), studentTeacherItems);

/** Submit wrapper */
async function safeSubmit(payload){
  try{
    payload.id = payload.id || ("r_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16));
    payload.createdAt = nowISO();
    payload.meta = deviceMeta();
    await postToSheet(payload);
    showOk("ุชู ุญูุธ ุงูุงุณุชุฌุงุจุฉ ูู Google Sheet โ ุดูุฑูุง ูู");
  }catch(e){
    console.error(e);
    showErr("ุชุนุฐุฑ ุงูุญูุธ. ุชุฃูุฏู ูู: ูุดุฑ Web App (Anyone) + ุงูุตูุงุญูุงุช + ูุฌูุฏ sheets: responses/settings");
  }
}

/** Handlers */
document.getElementById('impact_submit').addEventListener('click', async ()=>{
  const school = document.getElementById('impact_school').value.trim();
  const program = document.getElementById('impact_program').value.trim();
  if(!requiredFilled(school, program)){ showErr("ูุถูุงู ุฃุฏุฎูู ุงุณู ุงููุฏุฑุณุฉ ูุงุณู ุงูุจุฑูุงูุฌ (ูุทููุจุงู)."); return; }
  await safeSubmit({
    type:"impact",
    school, program,
    domain: document.getElementById('impact_domain').value || "",
    targets: document.getElementById('impact_targets').value.trim(),
    performance: document.getElementById('impact_perf').value || "",
    impactLevel: document.getElementById('impact_level').value || "",
    goalPct: Number(document.getElementById('impact_goalPct').value || 0),
    effectPct: Number(document.getElementById('impact_effectPct').value || 0),
    tools: getCheckedValues('impact_tools'),
    method: document.getElementById('impact_method').value || "",
    date: document.getElementById('impact_date').value || "",
    week: document.getElementById('impact_week').value.trim(),
    nStudents: Number(document.getElementById('impact_nStudents').value || 0),
    nTeachers: Number(document.getElementById('impact_nTeachers').value || 0),
    nParents: Number(document.getElementById('impact_nParents').value || 0),
    committee: document.getElementById('impact_committee').value || "",
    positives: document.getElementById('impact_positives').value.trim(),
    challenges: document.getElementById('impact_challenges').value.trim(),
    evidenceLinks: document.getElementById('impact_evidenceLinks').value.split('\n').map(x=>x.trim()).filter(Boolean),
  });
});

document.getElementById('t_submit').addEventListener('click', async ()=>{
  const school = document.getElementById('t_school').value.trim();
  if(!requiredFilled(school)){ showErr("ูุถูุงู ุฃุฏุฎู/ู ุงุณู ุงููุฏุฑุณุฉ (ูุทููุจ)."); return; }
  await safeSubmit({
    type:"teacher_satisfaction",
    school,
    name: document.getElementById('t_name').value.trim(),
    answers: readLikertAnswers(document.getElementById('t_items')),
    notes: document.getElementById('t_notes').value.trim()
  });
});

document.getElementById('s_submit').addEventListener('click', async ()=>{
  const school = document.getElementById('s_school').value.trim();
  if(!requiredFilled(school)){ showErr("ูุถูุงู ุฃุฏุฎู/ู ุงุณู ุงููุฏุฑุณุฉ (ูุทููุจ)."); return; }
  await safeSubmit({
    type:"student_school_satisfaction",
    school,
    grade: document.getElementById('s_grade').value.trim(),
    name: document.getElementById('s_name').value.trim(),
    answers: readLikertAnswers(document.getElementById('s_items')),
    notes: document.getElementById('s_notes').value.trim()
  });
});

document.getElementById('p_submit').addEventListener('click', async ()=>{
  const school = document.getElementById('p_school').value.trim();
  if(!requiredFilled(school)){ showErr("ูุถูุงู ุฃุฏุฎู/ู ุงุณู ุงููุฏุฑุณุฉ (ูุทููุจ)."); return; }
  await safeSubmit({
    type:"parent_satisfaction",
    school,
    parentName: document.getElementById('p_name').value.trim(),
    education: document.getElementById('p_edu').value.trim(),
    studentName: document.getElementById('p_student').value.trim(),
    answers: readLikertAnswers(document.getElementById('p_items')),
    notes: document.getElementById('p_notes').value.trim()
  });
});

document.getElementById('st_submit').addEventListener('click', async ()=>{
  const school = document.getElementById('st_school').value.trim();
  if(!requiredFilled(school)){ showErr("ูุถูุงู ุฃุฏุฎู/ู ุงุณู ุงููุฏุฑุณุฉ (ูุทููุจ)."); return; }
  await safeSubmit({
    type:"student_teacher_satisfaction",
    school,
    subject: document.getElementById('st_subject').value.trim(),
    grade: document.getElementById('st_grade').value.trim(),
    name: document.getElementById('st_name').value.trim(),
    answers: readLikertAnswers(document.getElementById('st_items')),
    notes: document.getElementById('st_notes').value.trim()
  });
});

/** Status */
(async ()=>{
  try{
    const ok = await ping();
    statusLine.textContent = ok ? "โ ุงูุงุชุตุงู ุฌุงูุฒ ูุงูุญูุธ ุณูุนูู" : "โ๏ธ ุงูุฑุงุจุท ููุฌูุฏ ููู ูู ูุชู ุชุฃููุฏ ุงูุงุชุตุงู";
  }catch{
    statusLine.textContent = "โ ุชุนุฐุฑ ุงูุงุชุตุงู โ ุฑุงุฌุนู ุงููุดุฑ Web App (Anyone) ูุงูุตูุงุญูุงุช";
  }
})();
</script>
</body>
</html>
